---
title: "An√°lise de Correla√ß√£o Can√¥nica de Indicadores Municipais"
author: "Gabriel Cardoso"
lang: pt
format:
  html:
    theme: cosmo
    toc: true
    toc-location: left
    code-fold: true
    code-summary: "Exibir c√≥digo"
    number-sections: true
    self-contained: true
editor: visual
bibliography: references.bib
nocite: |
  @*
---

# üìä Resumo do Projeto: Extens√£o para Correla√ß√£o Can√¥nica

Este projeto, originalmente focado na identifica√ß√£o de fatores latentes, expande sua fronteira anal√≠tica para investigar a interdepend√™ncia entre conjuntos distintos de indicadores. Ap√≥s sintetizar a estrutura dos dados via An√°lise Fatorial, utiliza-se a **An√°lise de Correla√ß√£o Can√¥nica (ACC)** para modelar a rela√ß√£o entre o bloco de vari√°veis de **Infraestrutura e Porte Econ√¥mico** e o bloco de **Desenvolvimento Humano e Bem-Estar**.

O objetivo nesta etapa √© determinar como a robustez econ√¥mica e f√≠sica de um munic√≠pio brasileiro prediz e se associa ao seu desempenho social. Essa abordagem permite ir al√©m da redu√ß√£o de dados, focando na for√ßa da associa√ß√£o entre diferentes dom√≠nios da gest√£o p√∫blica e da realidade municipal.

# An√°lise de Correla√ß√£o Can√¥nica (ACC)

A **An√°lise de Correla√ß√£o Can√¥nica** √© uma t√©cnica estat√≠stica multivariada avan√ßada que permite examinar a rela√ß√£o entre dois conjuntos de vari√°veis simultaneamente. Enquanto a regress√£o m√∫ltipla prev√™ uma √∫nica vari√°vel dependente a partir de v√°rias independentes, a ACC identifica a m√°xima correla√ß√£o poss√≠vel entre combina√ß√µes lineares de dois grupos de vari√°veis ($X$ e $Y$).

O modelo busca criar pares de **Vari√°veis Can√¥nicas** ($U$ e $V$), que s√£o pontua√ß√µes compostas que representam cada conjunto original:

$U_1 = a_{1}X_1 + a_{2}X_2 + \dots + a_{p}X_p$

$V_1 = b_{1}Y_1 + b_{2}Y_2 + \dots + b_{q}Y_q$

Neste contexto:

-   $U_k$ e $V_k$: S√£o as vari√°veis can√¥nicas (ou fun√ß√µes) que maximizam a correla√ß√£o ($\rho$) entre os dois blocos.

-   **Cargas Can√¥nicas**: Indicam a contribui√ß√£o de cada vari√°vel original (como PIB ou IDH) para a sua respectiva fun√ß√£o can√¥nica.

-   **Autoajuste**: O m√©todo garante que cada par sucessivo de vari√°veis can√¥nicas seja independente (ortogonal) dos pares anteriores, permitindo identificar m√∫ltiplas "camadas" de rela√ß√£o entre os dados municipais.

# Conjunto de dados

```{r,warning=FALSE,message=FALSE,echo=FALSE}
setwd("C:/Users/gabriel.cardoso/Desktop/projetos github/PROJETOS COM R/AF")
```

```{r,warning=FALSE,message=FALSE}
library(tidyverse)
library(readxl)
library(DT)
library(ggcorrplot)
library(corrplot)
library(CCA)
library(CCP)
library(candisc)
library(rio)
library(dplyr)

df <- import("BRAZIL_CITIES.csv")

# Inspecionar o dataset
str(df)
```

Selecionar vari√°veis de interesse para ser mais din√¢mico

```{r}
# 1Ô∏è‚É£ Sele√ß√£o de vari√°veis num√©ricas existentes
variaveis_afe <- c(
  "IBGE_RES_POP_BRAS",   # popula√ß√£o
  "AREA",                # √°rea do munic√≠pio
  "GDP",                 # PIB
  "GDP_CAPITA",          # PIB per capita
  "IDHM_Renda",          # renda
  "IDHM_Educacao",       # educa√ß√£o
  "IDHM_Longevidade",    # longevidade
  "Cars",                # carros
  "Motorcycles",         # motos
  "FIXED_PHONES",        # telefones fixos
  "PAY_TV"               # TVs
)

dados_afe <- df %>% dplyr::select(all_of(variaveis_afe))
```

```{r}
# 2Ô∏è‚É£ Converter AREA para num√©rico (tem v√≠rgula no CSV)
dados_afe$AREA <- as.numeric(gsub(",", "", dados_afe$AREA))

# 3Ô∏è‚É£ Tratar missing
dados_afe <- dados_afe %>% mutate(across(everything(), ~ifelse(is.na(.), mean(., na.rm = TRUE), .)))
```

# Visualizar correla√ß√µes

```{r}
corrplot(cor(dados_afe), 
         method = "color", 
         type = "lower",        # Exibe apenas a parte inferior
         diag = FALSE,          # Remove a diagonal principal (1.00)
         tl.col = "black", 
         tl.cex = 0.8, 
         tl.srt = 45,           
         addCoef.col = "white", 
         number.cex = 0.7)
```

Observe o bloco azul escuro no canto inferior direito e no canto superior esquerdo. Vari√°veis como **IBGE_RES_POP**, **GDP (PIB)**, **Cars**, **Fixed_Phones** e **Pay_TV** est√£o quase que perfeitamente correlacionadas ($r \approx 1$).

-   **O que isso significa:** Elas est√£o medindo basicamente a mesma coisa: "tamanho da cidade" ou "riqueza total".

# An√°lise de correla√ß√£o can√¥nica

Prepara√ß√£o dos Conjuntos de Vari√°veis ($X$ e $Y$)

No R, precisamos separar as colunas em dois objetos distintos para que a fun√ß√£o possa calcular a correla√ß√£o entre as matrizes.

```{r}
# Grupo X: Infraestrutura, Porte e Economia
X <- dados_afe %>% 
  dplyr::select(IBGE_RES_POP_BRAS, AREA, GDP, Cars, Motorcycles, FIXED_PHONES, PAY_TV)

# Grupo Y: Bem-estar e Desenvolvimento Humano
Y <- dados_afe %>% 
  dplyr::select(GDP_CAPITA, IDHM_Renda, IDHM_Educacao, IDHM_Longevidade)

# Escalonamento (opcional, mas recomendado para facilitar a interpreta√ß√£o das cargas)
X_scale <- scale(X)
Y_scale <- scale(Y)
```

Execu√ß√£o da ACC

```{r}
library(CCA)

# Executando a An√°lise de Correla√ß√£o Can√¥nica
res_cca <- cancor(X_scale, Y_scale)

res_cca


```

A an√°lise de vari√¢ncia demonstra que o primeiro par can√¥nico √© o principal eixo de conex√£o entre os dom√≠nios, concentrando mais de **71% da vari√¢ncia compartilhada**. Contudo, o coeficiente de determina√ß√£o ($R^2 = 0.13$) sugere que o 'porte' das cidades brasileiras explica apenas uma fatia moderada dos indicadores de bem-estar social, deixando margem para a influ√™ncia de fatores locais, geogr√°ficos ou pol√≠ticos que n√£o est√£o contidos apenas no volume econ√¥mico bruto.

# Coeficientes can√¥nicos

```{r}
coef(res_cca, type = "both", standardize = T)
```

Os coeficientes can√¥nicos padronizados revelam que a rela√ß√£o entre os blocos √© constru√≠da de forma complexa. No dom√≠nio da infraestrutura, a **Telefonia Fixa** e a **Frota de Ve√≠culos** s√£o os indicadores com maior peso relativo para maximizar a correla√ß√£o com o bloco social. No dom√≠nio do desenvolvimento humano, a **Educa√ß√£o** e a **Renda** consolidam-se como os principais componentes da vari√°vel can√¥nica social, demonstrando que esses dois indicadores s√£o os que melhor captam a influ√™ncia exercida pela estrutura econ√¥mica e f√≠sica do munic√≠pio.

# Verfica√ß√£o do ajuste

```{r}
# Gr√°fico principal da ACC
plot(res_cca, main = "Correla√ß√£o entre os Pares Can√¥nicos", 
     xlab = "Vari√°vel Can√¥nica X (Infraestrutura)", 
     ylab = "Vari√°vel Can√¥nica Y (Desenvolvimento Social)")
```

Este gr√°fico valida a hip√≥tese de que o crescimento econ√¥mico e a infraestrutura urbana (medida por vari√°veis como frota de ve√≠culos, PIB e servi√ßos) funcionam como um suporte para o avan√ßo social. No entanto, a dispers√£o dos pontos sugere que a infraestrutura √© uma condi√ß√£o necess√°ria, mas n√£o suficiente, para garantir o bem-estar, indicando que outros fatores (como gest√£o p√∫blica e efici√™ncia de gastos) tamb√©m jogam um papel crucial no IDHM das cidades.

```{r}
# Gerando o HE Plot focado nas vari√°veis do Grupo X (Infraestrutura)
heplot(res_cca, 
       col = c("red", "black"), 
       var.vectors = "X", 
       main = "HE Plot: Influ√™ncia das Vari√°veis de Infraestrutura (X)")
```

A an√°lise integrada dos scores e do gr√°fico HE revela que o desenvolvimento social dos munic√≠pios brasileiros est√° intrinsecamente ligado √† escala urbana e ao acesso a servi√ßos. A forte converg√™ncia de vetores como frota de ve√≠culos e telefonia fixa no HE Plot demonstra que a infraestrutura de servi√ßos √© o principal preditor do bem-estar capturado pelo modelo. No entanto, a dispers√£o observada no gr√°fico de scores (0,36) sugere que, embora a riqueza econ√¥mica (PIB) e o porte populacional ajudem a alavancar os √≠ndices sociais, eles n√£o s√£o os √∫nicos determinantes, havendo espa√ßo para a influ√™ncia de pol√≠ticas p√∫blicas locais.

# Conclus√£o

Em suma, os dados sugerem que a **escala urbana** (popula√ß√£o e servi√ßos) √© um motor potente para o desenvolvimento social, mas n√£o √© um destino garantido. O modelo can√¥nico demonstrou que a "receita" para o sucesso municipal brasileiro envolve a convers√£o da infraestrutura de base em ativos de capital humano (Renda e Educa√ß√£o). Este trabalho oferece uma base s√≥lida para gestores identificarem que o fortalecimento da infraestrutura urbana √©, na verdade, um investimento direto nos √≠ndices de desenvolvimento humano da popula√ß√£o.
